<html>
<body>
<head>
<meta name=viewport content="width=device-width, initial-scale=1">
<style>
* {
    text-align: center;
    margin-left: auto;
    margin-right: auto;
    font-family: sans-serif;
    color: #262626;
}
body {
    display: flex;
    flex-direction: column;
    background-color: hsla(0, 0%, 0%, 0.15);
    height: 90%;
}
path {
    fill: none;
    stroke-width: 5;
    stroke: red;
}
#white {
    stroke: white;
}
text {
    font-size: 32pt;
    fill: #262626;
}
h1 {
    font-size: 30pt;
    min-height: 30pt;
}
svg {
    min-height: 200px;
    margin: 0px 20px;
}
</style>
</head>

<h1 id="period"></h1>

<svg viewBox="0 0 160 160">
    <path id="white" d="M79,4 a75,75 0 1,1 0,150 a75,75 0 1,1 0,-150"/>
    <path id="red" d="M79,4 a75,75 0 1,1 0,150 a75,75 0 1,1 0,-150"/>
    <text text-anchor="middle" alignment-baseline="middle" x="80" y="81"></text>
</svg>

</body>
<script>
var schedule = [,[[490,540,"1st Period"],[545,600,"2nd Period"],[600,610,"Brunch"],[615,665,"3rd Period"],[670,720,"4th Period"],[720,765,"Lunch"],[770,820,"5th Period"],[825,875,"6th Period"],[880,930,"7th Period"]],[[490,535,"1st Period"],[540,590,"2nd Period"],[590,600,"Brunch"],[605,650,"3rd Period"],[655,685,"Tutorial"],[690,735,"4th Period"],[735,780,"Lunch"],[785,830,"5th Period"],[835,880,"6th Period"],[885,930,"7th Period"]],[[530,625,"2nd Period"],[625,640,"Brunch"],[645,735,"4th Period"],[735,780,"Lunch"],[785,875,"6th Period"]],[[490,585,"1st Period"],[585,600,"Brunch"],[605,695,"3rd Period"],[695,740,"Lunch"],[745,835,"5th Period"],[840,930,"7th Period"]],[[490,540,"1st Period"],[545,600,"2nd Period"],[600,610,"Brunch"],[615,665,"3rd Period"],[670,720,"4th Period"],[720,765,"Lunch"],[770,820,"5th Period"],[825,875,"6th Period"],[880,930,"7th Period"]]];

var currentPeriod;

(function tick(){
    var periodElem = document.getElementById("period"),
        textElem = document.getElementsByTagName("text")[0],
        date = new Date(),
        time = getMinuteTime(),
        day = schedule[date.getDay()];

    if(day && time >= day[0][0] && time < day[day.length-1][1]){
        var period = getPeriod(time, day),
            minutesLeft = period[1] - time,
            seconds = date.getSeconds(),
            secondsLeft = seconds ? (minutesLeft--,60-seconds) : seconds;

        periodElem.innerHTML = period[2];
        document.title = textElem.innerHTML = createTimeString(minutesLeft / 60 | 0, minutesLeft % 60, secondsLeft);

        if(!currentPeriod){
            requestAnimationFrame(setProgressBar);
        }
        currentPeriod = period;
    }
    else {
        currentPeriod = null;
        periodElem.innerHTML = document.title = "No School";
        textElem.innerHTML = "";

        var path = document.getElementById("red"),
            length = path.getTotalLength();

        path.style.strokeDasharray = length + " " + length;
        path.style.strokeDashoffset = length;
    }
    setTimeout(tick, 1000 - (Date.now() % 1000));
})();

function createTimeString(h, m, s){
    var hs = h.toString(),
        ss = s < 10 ? "0" + s.toString() : s.toString();

    if(h > 0){
        return hs + ":" + (m < 10 ? "0" : "") + m + ":" + ss;
    }
    else if(m > 0){
        return (m < 10 ? "0" : "") + m + ":" + ss;
    }
    return "00:" + ss;
}

function getPeriod(time, day){
    for(var i = 0; i < day.length; i++){
        if(time >= day[i][0] && time < day[i][1]){
            return day[i];
        }
        else if(i + 1 < day.length && time >= day[i][1] && time < day[i+1][0]){
            return [day[i][1], day[i+1][0], "Passing Period"];
        }
    }
}

function setProgressBar(){
    if(!currentPeriod){
        return;
    }
    var path = document.getElementById("red"),
        length = path.getTotalLength();

    path.style.strokeDasharray = length + " " + length;
    path.style.strokeDashoffset = length * (1 - percentPeriodElapsed(currentPeriod));
    requestAnimationFrame(setProgressBar);
}

function getMinuteTime(){
    var date = new Date();
    return date.getHours() * 60 + date.getMinutes();
}

function percentPeriodElapsed(period){
    var secondsInPeriod = 60 * (period[1] - period[0]);
    return secSinceMinTime(period[0]) / secondsInPeriod;
}

function secSinceMinTime(time){
    return 60 * (getMinuteTime() - time) + new Date().getSeconds();
}
</script>
</html>
