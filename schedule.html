<html>
<body>
<head>
<meta name=viewport content="width=device-width, initial-scale=1">
<style>
* {
    text-align: center;
    margin-left: auto;
    margin-right: auto;
}
path {
    fill: none;
    stroke-width: 2;
    stroke: red;
}
#gray {
    stroke: #eee;
}
</style>
</head>

<h1 id="period"></h1>

<svg width="70%" height="50%" viewBox="0 0 152 152">
	<path id="gray" d="M76,1 a75,75 0 1,1 0,150 a75,75 0 1,1 0,-150"/>
	<path id="red" d="M76,1 a75,75 0 1,1 0,150 a75,75 0 1,1 0,-150"/>
	<text text-anchor="middle" alignment-baseline="middle" x="76" y="76"></text>
</svg>

</body>
<script>
var schedule = [,["Monday",[490,540,"1st Period"],[545,600,"2nd Period"],[600,610,"Brunch"],[615,665,"3rd Period"],[670,720,"4th Period"],[720,765,"Lunch"],[770,820,"5th Period"],[825,875,"6th Period"],[880,930,"7th Period"]],["Tuesday",[490,535,"1st Period"],[540,590,"2nd Period"],[590,600,"Brunch"],[605,650,"3rd Period"],[655,685,"Tutorial"],[690,735,"4th Period"],[735,780,"Lunch"],[785,830,"5th Period"],[835,880,"6th Period"],[885,930,"7th Period"]],["Wednesday",[530,625,"2nd Period"],[625,640,"Brunch"],[645,735,"4th Period"],[735,780,"Lunch"],[785,875,"6th Period"]],["Thursday",[490,585,"1st Period"],[585,600,"Brunch"],[605,695,"3rd Period"],[695,740,"Lunch"],[745,835,"5th Period"],[840,930,"7th Period"]],["Friday",[490,540,"1st Period"],[545,600,"2nd Period"],[600,610,"Brunch"],[615,665,"3rd Period"],[670,720,"4th Period"],[720,765,"Lunch"],[770,820,"5th Period"],[825,875,"6th Period"],[880,930,"7th Period"]]];

var currentPeriod;
    
function createTimeString(h, m, s){
	var hs = h.toString(),
    	ss = s < 10 ? "0" + s.toString() : s.toString();
    
    if(h > 0){
        return hs + ":" + (m < 10 ? "0" : "") + m + ":" + ss;
    }
    else if(m > 0){
    	return m + ":" + ss;
    }
    return "0:" + ss;
}

(function tick(){
	var periodElem = document.getElementById("period"),
		textElem = document.getElementsByTagName("text")[0],
		date = new Date(),
		time = date.getHours() * 60 + date.getMinutes(),
		day = schedule[date.getDay()];
    
	if(day && time >= day[1][0] && time < day[day.length-1][1]){
    	var period = getPeriod(time, day),
        	minutesLeft = period[1] - time,
    		seconds = date.getSeconds(),
        	secondsLeft = seconds ? (minutesLeft--,60-seconds) : seconds;

        periodElem.innerHTML = period[2];
       	document.title = textElem.innerHTML = createTimeString(minutesLeft / 60 | 0, minutesLeft % 60, secondsLeft);
        
		if(!currentPeriod || !currentPeriod.every(function(c,i){return c == period[i]})){
			setProgressBar(60 * (period[1] - period[0]), 60 * (time - period[0]) + seconds);
			currentPeriod = period;
		}
	}
	else {
		periodElem.innerHTML = document.title = "No School";
		textElem.innerHTML = "";
	}
	setTimeout(tick, 1000);
})();
    
function getPeriod(time, day){
	for(var i = 1; i < day.length; i++){
    	if(time >= day[i][0] && time < day[i][1]){
        	return day[i];
        }
        else if(i + 1 < day.length && time >= day[i][1] && time < day[i+1][0]){
            return [day[i][1], day[i+1][0], "Passing Period"];	
        }
    }
}

function setProgressBar(duration, offset){
    var path = document.getElementById("red");
    var length = path.getTotalLength();
    path.style.transition = "none";
    path.style.strokeDasharray = length + " " + length;
    path.style.strokeDashoffset = length;
    path.getBoundingClientRect();
    path.style.transition = "stroke-dashoffset " + duration + "s linear" + (offset? " -" + offset + "s" : "");
    path.style.strokeDashoffset = '0';
}
</script>
</html>
